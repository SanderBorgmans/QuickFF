

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorials &mdash; QuickFF 2.2.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Validation" href="vl.html" />
    <link rel="prev" title="User Guide" href="ug.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> QuickFF
          

          
            
            <img src="_static/quickff_logo_trans_small.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="papers.html">QuickFF literature</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ig.html">Installation Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ig.html#dependencies">Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ig.html#molmod-dependency">MolMod dependency</a></li>
<li class="toctree-l3"><a class="reference internal" href="ig.html#yaff-dependency">Yaff dependency</a></li>
<li class="toctree-l3"><a class="reference internal" href="ig.html#external-dependencies">External dependencies</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ig.html#downloading-quickff">Downloading QuickFF</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ig.html#stable-release">Stable release</a></li>
<li class="toctree-l3"><a class="reference internal" href="ig.html#latest-development-version-experts-only">Latest development version (experts only)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ig.html#installing-quickff">Installing QuickFF</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ug.html">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ug.html#quickff-settings">QuickFF Settings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ug.html#settings-description">Settings description</a><ul>
<li class="toctree-l4"><a class="reference internal" href="ug.html#general-settings">General settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="ug.html#input-output-settings">Input/output settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="ug.html#reference-force-field-contribution-settings">Reference force field contribution settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="ug.html#force-field-expression-settings">Force field expression settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="ug.html#fitting-algorithm-settings">Fitting algorithm settings</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ug.html#default-settings">Default settings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ug.html#preparing-electrostatic-force-field">Preparing electrostatic force field</a></li>
<li class="toctree-l2"><a class="reference internal" href="ug.html#quickff-main-script-qff-py">QuickFF main script qff.py</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ug.html#mandatory-input-files">Mandatory input files</a></li>
<li class="toctree-l3"><a class="reference internal" href="ug.html#optional-input-files">Optional input files</a></li>
<li class="toctree-l3"><a class="reference internal" href="ug.html#automatic-estimation-of-atom-types">Automatic estimation of atom types</a></li>
<li class="toctree-l3"><a class="reference internal" href="ug.html#miscellanous-options">Miscellanous options</a></li>
<li class="toctree-l3"><a class="reference internal" href="ug.html#output">Output</a></li>
<li class="toctree-l3"><a class="reference internal" href="ug.html#logging">Logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="ug.html#parallel-quickff">Parallel QuickFF</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ug.html#importing-quickff-as-a-library">Importing QuickFF as a library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ug.html#define-the-system">Define the system</a></li>
<li class="toctree-l3"><a class="reference internal" href="ug.html#define-the-ab-initio-reference">Define the ab initio reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="ug.html#define-force-field-reference-objects">Define force field reference objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="ug.html#define-the-program-and-run-it">Define the program and run it</a></li>
<li class="toctree-l3"><a class="reference internal" href="ug.html#id3">Logging</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#tutorial-1-benzene">Tutorial 1 - Benzene</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#covalent-force-field-without-non-bonding-terms">Covalent force field without non-bonding terms</a></li>
<li class="toctree-l3"><a class="reference internal" href="#force-field-with-electrostatics">Force field with electrostatics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tutorial-2-water">Tutorial 2 - Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tutorial-3-biphenyl">Tutorial 3 - Biphenyl</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="vl.html">Validation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="vl.html#validation-methodology">Validation methodology</a></li>
<li class="toctree-l2"><a class="reference internal" href="vl.html#validation-1-water">Validation 1 - Water</a><ul>
<li class="toctree-l3"><a class="reference internal" href="vl.html#force-field-construction">Force field construction</a></li>
<li class="toctree-l3"><a class="reference internal" href="vl.html#force-field-evaluation">Force field evaluation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="vl.html#perturbation-trajectories">Perturbation trajectories</a></li>
<li class="toctree-l4"><a class="reference internal" href="vl.html#geometry-and-frequencies">Geometry and frequencies</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="vl.html#validation-2-benzene">Validation 2 - Benzene</a><ul>
<li class="toctree-l3"><a class="reference internal" href="vl.html#id1">Force field construction</a></li>
<li class="toctree-l3"><a class="reference internal" href="vl.html#id2">Force field evaluation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="vl.html#id3">Perturbation trajectories</a></li>
<li class="toctree-l4"><a class="reference internal" href="vl.html#id4">Geometry and frequencies</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="rg.html">Reference Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="rg.html#modules">Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="rg.html#module-quickff.cost"><code class="docutils literal"><span class="pre">quickff.cost</span></code> – Least-Square cost function for hessian matching</a></li>
<li class="toctree-l3"><a class="reference internal" href="rg.html#module-quickff.io"><code class="docutils literal"><span class="pre">quickff.io</span></code> – Input/Ouput methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="rg.html#module-quickff.settings"><code class="docutils literal"><span class="pre">quickff.settings</span></code> – QuickFF configuration settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="rg.html#module-quickff.perturbation"><code class="docutils literal"><span class="pre">quickff.perturbation</span></code> – Perturbation trajectories for internal coordinates</a></li>
<li class="toctree-l3"><a class="reference internal" href="rg.html#module-quickff.program"><code class="docutils literal"><span class="pre">quickff.program</span></code> – Program classes implementing a sequence of fitting steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="rg.html#module-quickff.reference"><code class="docutils literal"><span class="pre">quickff.reference</span></code> – Representation of the ab initio reference data</a></li>
<li class="toctree-l3"><a class="reference internal" href="rg.html#module-quickff.tools"><code class="docutils literal"><span class="pre">quickff.tools</span></code> – Various convenient tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="rg.html#module-quickff.valence"><code class="docutils literal"><span class="pre">quickff.valence</span></code> – ValenceFF class storing all valence ff terms</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="rg.html#scripts">Scripts</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">QuickFF</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Tutorials</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/tu.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tutorials">
<h1>Tutorials<a class="headerlink" href="#tutorials" title="Permalink to this headline">¶</a></h1>
<div class="section" id="tutorial-1-benzene">
<h2>Tutorial 1 - Benzene<a class="headerlink" href="#tutorial-1-benzene" title="Permalink to this headline">¶</a></h2>
<p>This tutorial will describe in detail the use of QuickFF by means of the command
line scripts, to generate a force field for benzene. This tutorial assumes that
the following input files are available (examples of such file are provided with
the source code in the directory <cite>share/systems/benzene</cite>):</p>
<ul>
<li><dl class="first docutils">
<dt><code class="docutils literal"><span class="pre">gaussian.fchk</span></code></dt>
<dd><p class="first">A Gaussian Formatted Checkpoint file containing the ab initio equilibrium
geometry and ab initio Hessian in equilibrium. This file can be generated
by performing a freq job in Gaussian using your level of theory and basis
set of choice. The following line should be added prior to the route
section (i.e. the lines starting with #):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">chk</span><span class="o">=</span><span class="n">gaussian</span><span class="o">.</span><span class="n">chk</span>
</pre></div>
</div>
<p>When the calculation terminated succesfully, make the fchk file using the
following command:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">formchk</span> <span class="n">gaussian</span><span class="o">.</span><span class="n">chk</span> <span class="n">gaussian</span><span class="o">.</span><span class="n">fchk</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal"><span class="pre">gaussian_mbis.h5</span></code></dt>
<dd><p class="first">A HDF5 file containing the atomic charges. Such a file can, for example, be
generated using <a class="reference external" href="http://molmod.github.com/horton/">HORTON</a>. If you have HORTON 2.x
installed, the following command will derive the atomic charges in this example from
the wavefunction in the <code class="docutils literal"><span class="pre">gaussian.fchk</span></code> file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">horton</span><span class="o">-</span><span class="n">wpart</span><span class="o">.</span><span class="n">py</span> <span class="n">gaussian</span><span class="o">.</span><span class="n">fchk</span> <span class="n">gaussian_mbis</span><span class="o">.</span><span class="n">h5</span> <span class="n">mbis</span> <span class="o">--</span><span class="n">grid</span><span class="o">=</span><span class="n">ultrafine</span>
</pre></div>
</div>
<p>To determine
the path in the HDF5 file to these charges, one can use the <cite>h5dump</cite>
command (part of the Linux package <cite>hdf5-tools</cite>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">h5dump</span> <span class="o">-</span><span class="n">n</span> <span class="n">gaussian_mbis</span><span class="o">.</span><span class="n">h5</span>
</pre></div>
</div>
<p>The output of this command for the gaussian_mbis.h5 file provided in the
directory <code class="docutils literal"><span class="pre">share/tuturials/benzene</span></code> is:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>HDF5 &quot;gaussian_mbis.h5&quot; {
FILE_CONTENTS {
 group      /
 dataset    /cartesian_multipoles
 dataset    /change
 dataset    /charges
 dataset    /core_charges
 dataset    /history_charges
 dataset    /history_propars
 dataset    /niter
 dataset    /populations
 dataset    /propars
 dataset    /pseudo_populations
 dataset    /pure_multipoles
 dataset    /radial_moments
 dataset    /valence_charges
 dataset    /valence_widths
 }
}
</pre></div>
</div>
<p class="last">From this output, we can conclude that, for this example, MBIS charges can
be found in the path <code class="docutils literal"><span class="pre">/charges</span></code>.</p>
</dd>
</dl>
</li>
</ul>
<div class="section" id="covalent-force-field-without-non-bonding-terms">
<h3>Covalent force field without non-bonding terms<a class="headerlink" href="#covalent-force-field-without-non-bonding-terms" title="Permalink to this headline">¶</a></h3>
<p>As a first example, we will derive a force field containing only covalent terms.
No electrostatic nor van der Waals interactions will be included in the force
field. Furthermore, we use the <a class="reference internal" href="ug.html#seclab-ug-atype-estimator"><span class="std std-ref">built-in feature</span></a> to automatically determine atom types according to
the level <cite>low</cite> (for benzene it does not make any difference which level is
chosen). This can very easily be done using the <a class="reference internal" href="trash/rg_scripts.html#seclab-rg-scripts-qff"><span class="std std-ref">qff.py</span></a> script (documentation on the available options can be
accessed by <cite>qff.py</cite> <code class="xref std std-option docutils literal"><span class="pre">--help</span></code>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">qff</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">ffatypes</span><span class="o">=</span><span class="n">low</span> <span class="o">--</span><span class="n">suffix</span><span class="o">=</span><span class="n">_noei</span> <span class="n">gaussian</span><span class="o">.</span><span class="n">fchk</span>
</pre></div>
</div>
<p>The script will dump all relevant information to the screen, for this tutorial,
the output is as follows:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/home/louis/build/anaconda3/bin/qff.py&quot;, line 38, in &lt;module&gt;
    qff()
  File &quot;/home/louis/build/anaconda3/lib/python3.6/site-packages/quickff/scripts.py&quot;, line 348, in qff
    settings = Settings(fn=args.config_file, **kwargs)
  File &quot;/home/louis/build/anaconda3/lib/python3.6/site-packages/quickff/settings.py&quot;, line 177, in __init__
    self.check()
  File &quot;/home/louis/build/anaconda3/lib/python3.6/site-packages/quickff/settings.py&quot;, line 241, in check
    check_function(key,value)
  File &quot;/home/louis/build/anaconda3/lib/python3.6/site-packages/quickff/settings.py&quot;, line 83, in is_nonexisting_file_name
    raise IOError(&#39;Setting for key %s should be non-existing file name, got %s which already exists.&#39; %(key, value))
OSError: Setting for key fn_yaff should be non-existing file name, got pars_yaff_noei.txt which already exists.
</pre></div>
</div>
<p>The logger will dump to following information to the screen (or a file if the
<code class="xref std std-option docutils literal"><span class="pre">--logfile</span></code> option was used):</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>Machine environment:</dt>
<dd>This section contains some general information about the machine environment
on which you ran the quickff job. It contains the user name, machine info,
starting time of job, Python version, Numpy version, Scipy versoin,
Matplotlib version, current directory and the command used
to envoke quickff.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Routine sequence:</dt>
<dd>Every task that is performed will be shown in the log output. For example,
the line <code class="docutils literal"><span class="pre">PTGEN</span>&#160; <span class="pre">Constructing</span> <span class="pre">trajectories</span></code> indicates that QuickFF is
busy constructing the perturbation trajectories. As a second example, the
line <code class="docutils literal"><span class="pre">HCEST</span>&#160; <span class="pre">Estimating</span> <span class="pre">force</span> <span class="pre">constants</span> <span class="pre">from</span> <span class="pre">Hessian</span> <span class="pre">cost</span> <span class="pre">for</span> <span class="pre">tasks</span>
<span class="pre">HC_FC_DIAG</span> <span class="pre">HC_FC_CROSS</span></code> indicates QuickFF is estimating force constants by
means of a least-square fit of the FF Hessian to the AI Hessian for each
term for which the task <cite>HC_FC_DIAG</cite> and <cite>HC_FC_CROSS</cite> was selected.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Final force field parameters:</dt>
<dd>The final FF parameters are shown at the end of the log output.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Timings:</dt>
<dd>Finally, a summary of the timings for several steps during run of the
program is provided.</dd>
</dl>
</li>
</ul>
<p>The force field parameters were also written to the Yaff parameters file
<cite>pars_yaff_noei.txt</cite>:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span># BONDHARM
#---------
BONDHARM:UNIT  K kjmol/A**2
BONDHARM:UNIT  R0 A

BONDHARM:PARS         C         H  3.3306196176e+03  1.0844158109e+00
BONDHARM:PARS         C         C  3.9640165131e+03  1.3946450208e+00


# BENDAHARM
#----------
BENDAHARM:UNIT  K kjmol/rad**2
BENDAHARM:UNIT  THETA0 deg

BENDAHARM:PARS         C         C         H  3.2099700563e+02  1.2000065910e+02
BENDAHARM:PARS         C         C         C  6.0322213479e+02  1.1999902902e+02


# TORSION
#--------
TORSION:UNIT  A kjmol
TORSION:UNIT  PHI0 deg

TORSION:PARS         C         C         C         H  2 3.1236662782e+01  0.0000000000e+00
TORSION:PARS         C         C         C         C  2 3.5927820437e+01  0.0000000000e+00
TORSION:PARS         H         C         C         H  2 1.6155379334e+01  0.0000000000e+00


# OOPDIST
#--------
OOPDIST:UNIT  K kjmol/A**2
OOPDIST:UNIT  D0 A

OOPDIST:PARS         C         C         H         C  1.7779654040e+02  1.2581804590e-07


# Cross
#------
Cross:UNIT  KSS kjmol/angstrom**2
Cross:UNIT  KBS0 kjmol/(angstrom*rad)
Cross:UNIT  KBS1 kjmol/(angstrom*rad)
Cross:UNIT  R0 angstrom
Cross:UNIT  R1 angstrom
Cross:UNIT  THETA0 deg

Cross:PARS         C         C         H   3.7836795182e+01   1.1489177232e+02   1.3847234510e+02  1.3946599160e+00  1.0844145084e+00  1.1999937065e+02
Cross:PARS         C         C         C   5.2502117018e+02   5.0720240430e+01   5.0720240430e+01  1.3946599160e+00  1.3946599160e+00  1.2000556448e+02
</pre></div>
</div>
</div>
<div class="section" id="force-field-with-electrostatics">
<h3>Force field with electrostatics<a class="headerlink" href="#force-field-with-electrostatics" title="Permalink to this headline">¶</a></h3>
<ul>
<li><dl class="first docutils">
<dt>Generating Yaff input</dt>
<dd><p class="first">First we need to generate the Yaff input file for the electrostatic
contribution to the force field. This is done using the script
<a class="reference internal" href="trash/rg_scripts.html#seclab-rg-scripts-inputei"><span class="std std-ref">qff_input-ei.py</span></a>. For this tutorial,
we will convert the charges given in the dataset <code class="docutils literal"><span class="pre">/charges</span></code> of the
file <code class="docutils literal"><span class="pre">gaussian_mbis.h5</span></code> for the atoms in gaussian.fchk with atom types
according to the level <cite>medium</cite> and use Gaussian charge distributions:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">qff</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="n">ei</span><span class="o">.</span><span class="n">py</span>  <span class="o">-</span><span class="n">v</span><span class="o">--</span><span class="n">ffatypes</span><span class="o">=</span><span class="n">low</span> <span class="o">--</span><span class="n">gaussian</span> <span class="n">gaussian</span><span class="o">.</span><span class="n">fchk</span> <span class="n">gaussian_mbis</span><span class="o">.</span><span class="n">h5</span><span class="p">:</span><span class="n">charges</span> <span class="n">pars_ei_mbisgauss</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>This command dumped the following output to the screen, indicating wheter or
not the atom types are well chosen from the point of view of electrostatics
(see second remark in <a class="reference internal" href="ug.html#seclab-ug-tools-inputei"><span class="std std-ref">qff-input-ei.py</span></a>):</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>Averaged Atomic Charges:
------------------------
     H     0.131 +-  0.000 (N=6)
     C    -0.132 +-  0.001 (N=6)
</pre></div>
</div>
<p>Furthermore, the following Yaff parameter (<cite>pars_ei.txt</cite>) file was written:</p>
<div class="last highlight-text"><div class="highlight"><pre><span></span>#Fixed charges
#---------------

FIXQ:UNIT Q0 e
FIXQ:UNIT P e
FIXQ:UNIT R angstrom
FIXQ:SCALE 1 1.0
FIXQ:SCALE 2 1.0
FIXQ:SCALE 3 1.0
FIXQ:DIELECTRIC 1.0

# Atomic parameters
# ----------------------------------------------------
# KEY        label  Q_0A              R_A
# ----------------------------------------------------
FIXQ:ATOM        H  0.1314377213  0.7308000000
FIXQ:ATOM        C -0.1315514661  1.1703000000
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Constructing the covalent contribution</dt>
<dd><p class="first">Now, we generate a covalent force field on top of the previously derived
electrostatic contribution using the qff.py script:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">qff</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">ffatype</span><span class="o">=</span><span class="n">low</span> <span class="o">--</span><span class="n">ei</span><span class="o">=</span><span class="n">pars_ei_mbisgauss</span><span class="o">.</span><span class="n">txt</span> <span class="o">--</span><span class="n">suffix</span><span class="o">=</span><span class="n">_mbisgauss</span> <span class="n">gaussian</span><span class="o">.</span><span class="n">fchk</span>
</pre></div>
</div>
<p>The logging output for this job is:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/home/louis/build/anaconda3/bin/qff.py&quot;, line 38, in &lt;module&gt;
    qff()
  File &quot;/home/louis/build/anaconda3/lib/python3.6/site-packages/quickff/scripts.py&quot;, line 348, in qff
    settings = Settings(fn=args.config_file, **kwargs)
  File &quot;/home/louis/build/anaconda3/lib/python3.6/site-packages/quickff/settings.py&quot;, line 177, in __init__
    self.check()
  File &quot;/home/louis/build/anaconda3/lib/python3.6/site-packages/quickff/settings.py&quot;, line 241, in check
    check_function(key,value)
  File &quot;/home/louis/build/anaconda3/lib/python3.6/site-packages/quickff/settings.py&quot;, line 83, in is_nonexisting_file_name
    raise IOError(&#39;Setting for key %s should be non-existing file name, got %s which already exists.&#39; %(key, value))
OSError: Setting for key fn_yaff should be non-existing file name, got pars_yaff_mbisgauss.txt which already exists.
</pre></div>
</div>
<p>An extra line appeared in the beginning of the log output, i.e.
<code class="docutils literal"><span class="pre">QFF</span>&#160;&#160;&#160; <span class="pre">Initializing</span> <span class="pre">Yaff</span> <span class="pre">force</span> <span class="pre">field</span> <span class="pre">reference</span> <span class="pre">for</span> <span class="pre">EI</span></code>. This indicates
that an extra reference instance was created to represent the EI
contribution to the force field. Furthermore, the covalent parameters are
almost identical compared to the FF without electrostatics. This is indeed
what we expect due to the charges being so small.</p>
<p>The force field parameters were also written to the Yaff parameters file
<cite>pars_yaff_mbisgauss.txt</cite>:</p>
<div class="last highlight-text"><div class="highlight"><pre><span></span># BONDHARM
#---------
BONDHARM:UNIT  K kjmol/A**2
BONDHARM:UNIT  R0 A

BONDHARM:PARS         C         H  3.3330947110e+03  1.0876030857e+00
BONDHARM:PARS         C         C  3.9651509073e+03  1.3940024796e+00


# BENDAHARM
#----------
BENDAHARM:UNIT  K kjmol/rad**2
BENDAHARM:UNIT  THETA0 deg

BENDAHARM:PARS         C         C         H  3.2097791035e+02  1.2015408281e+02
BENDAHARM:PARS         C         C         C  6.0195048827e+02  1.1997128615e+02


# TORSION
#--------
TORSION:UNIT  A kjmol
TORSION:UNIT  PHI0 deg

TORSION:PARS         C         C         C         H  2 3.1428590425e+01  0.0000000000e+00
TORSION:PARS         C         C         C         C  2 3.5982593319e+01  0.0000000000e+00
TORSION:PARS         H         C         C         H  2 1.6841711143e+01  0.0000000000e+00


# OOPDIST
#--------
OOPDIST:UNIT  K kjmol/A**2
OOPDIST:UNIT  D0 A

OOPDIST:PARS         C         C         H         C  1.6627879376e+02  1.4852790560e-07


# Cross
#------
Cross:UNIT  KSS kjmol/angstrom**2
Cross:UNIT  KBS0 kjmol/(angstrom*rad)
Cross:UNIT  KBS1 kjmol/(angstrom*rad)
Cross:UNIT  R0 angstrom
Cross:UNIT  R1 angstrom
Cross:UNIT  THETA0 deg

Cross:PARS         C         C         H   4.0314253139e+01   1.1314941390e+02   1.3908937391e+02  1.3934733019e+00  1.0875970642e+00  1.2001585516e+02
Cross:PARS         C         C         C   5.2510965154e+02   4.9272465820e+01   4.9272465820e+01  1.3934733019e+00  1.3934733019e+00  1.2003594739e+02
</pre></div>
</div>
</dd>
</dl>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="tutorial-2-water">
<span id="seclab-tu-water"></span><h2>Tutorial 2 - Water<a class="headerlink" href="#tutorial-2-water" title="Permalink to this headline">¶</a></h2>
<p>In the current tutorial, we will illustrate the usage of QuickFF as a library
by constructing a basic force field for water. In
<a class="reference internal" href="#seclab-tu-biphenyl"><span class="std std-ref">Tutorial 3</span></a>, we will cover the more advanced features
of QuickFF.</p>
<p>For this tutorial we again assume to have the input files <code class="docutils literal"><span class="pre">gaussian.fchk</span></code> and
<code class="docutils literal"><span class="pre">gaussian_mbis.h5</span></code>. We will construct a script (which we will give the name
<code class="docutils literal"><span class="pre">qff-derive.py</span></code>) that will read the input files, convert them to data objects
QuickFF can read and implement a small program using QuickFF modules to derive
the force field. These files, together with the expected output, can be found
in <code class="docutils literal"><span class="pre">share/tutorials/water</span></code>.</p>
<p>First, we define the required <span class="xref std std-ref">settings</span> using the
<span class="xref std std-ref">Settings</span> class:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">#settings</span>
<span class="k">with</span> <span class="n">log</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="s1">&#39;INIT&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">timer</span><span class="o">=</span><span class="s1">&#39;Initialization&#39;</span><span class="p">):</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">(</span><span class="n">fn_yaff</span><span class="o">=</span><span class="s1">&#39;pars_cov.txt&#39;</span><span class="p">,</span> <span class="n">plot_traj</span><span class="o">=</span><span class="s1">&#39;All&#39;</span><span class="p">,</span> <span class="n">xyz_traj</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Second, we load the input files and convert them to a Yaff
<a class="reference external" href="http://molmod.github.io/yaff/rg_yaff.html#module-yaff.system">system</a>
instance and a QuickFF
<a class="reference external" href="http://molmod.github.io/QuickFF/rg_module.html#module-quickff.reference">SecondOrderTaylor</a>
instance. Therefore, we use routines implemented in the
<a class="reference external" href="http://molmod.github.io/molmod/reference/io.html#module-molmod.io.fchk">fchk</a>
module of MolMod.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">#load Gaussian Formatted Checkpoint file</span>
<span class="n">fchk</span> <span class="o">=</span> <span class="n">FCHKFile</span><span class="p">(</span><span class="s1">&#39;gaussian.fchk&#39;</span><span class="p">)</span>
<span class="n">numbers</span> <span class="o">=</span> <span class="n">fchk</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Atomic numbers&#39;</span><span class="p">)</span>
<span class="n">energy</span> <span class="o">=</span> <span class="n">fchk</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Total Energy&#39;</span><span class="p">)</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">fchk</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Current cartesian coordinates&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">),</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">grad</span> <span class="o">=</span> <span class="n">fchk</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Cartesian Gradient&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">),</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">hess</span> <span class="o">=</span> <span class="n">fchk</span><span class="o">.</span><span class="n">get_hessian</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">),</span> <span class="mi">3</span><span class="p">])</span>

<span class="c1">#Construct Yaff System file</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">System</span><span class="p">(</span><span class="n">numbers</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
<span class="n">system</span><span class="o">.</span><span class="n">detect_bonds</span><span class="p">()</span>
<span class="n">system</span><span class="o">.</span><span class="n">set_standard_masses</span><span class="p">()</span>

<span class="c1">#Construct a QuickFF SecondOrderTaylor object containing the AI reference</span>
<span class="k">with</span> <span class="n">log</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="s1">&#39;INIT&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">timer</span><span class="o">=</span><span class="s1">&#39;Initialization&#39;</span><span class="p">):</span>
    <span class="n">ai</span> <span class="o">=</span> <span class="n">SecondOrderTaylor</span><span class="p">(</span><span class="s1">&#39;ai&#39;</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">,</span> <span class="n">energy</span><span class="o">=</span><span class="n">energy</span><span class="p">,</span> <span class="n">grad</span><span class="o">=</span><span class="n">grad</span><span class="p">,</span> <span class="n">hess</span><span class="o">=</span><span class="n">hess</span><span class="p">)</span>
</pre></div>
</div>
<p>At this instance, the system does not yet contain force field atom types. To
define these, we could use the <a class="reference external" href="http://molmod.github.io/QuickFF/rg_module.html#quickff.tools.guess_ffatypes">QuickFF feature guess_ffatypes</a>.
However, we can also use the <a class="reference external" href="http://molmod.github.io/yaff/ug_atselect.html">ATSELECT</a>
language of Yaff:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">#define atom types</span>
<span class="n">rules</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;1 &amp; =1%8&#39;</span><span class="p">),</span> <span class="c1">#hydrogen atom with one oxygen neighbor</span>
    <span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;8 &amp; =2%1&#39;</span><span class="p">),</span> <span class="c1">#oxygen atom with two hydrogen neighbors</span>
<span class="p">]</span>
<span class="n">system</span><span class="o">.</span><span class="n">detect_ffatypes</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>
</pre></div>
</div>
<p>The final input we need to parse, is the set of atomic charges. These charges
are read from the dataset <code class="docutils literal"><span class="pre">charges</span></code> in the HDF5 file <code class="docutils literal"><span class="pre">guassian_mbis.h5</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">#construct electrostatic force field from HE charges in gaussian_wpart.h5</span>
<span class="k">with</span> <span class="n">h5</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">&#39;gaussian_mbis.h5&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">charges</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;charges&#39;</span><span class="p">][:]</span>
<span class="n">scales</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="k">with</span> <span class="n">log</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="s1">&#39;INIT&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">timer</span><span class="o">=</span><span class="s1">&#39;Initialization&#39;</span><span class="p">):</span>
    <span class="n">ff_ei</span> <span class="o">=</span> <span class="n">get_ei_ff</span><span class="p">(</span><span class="s1">&#39;EI&#39;</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">charges</span><span class="p">,</span> <span class="n">scales</span><span class="p">,</span> <span class="n">radii</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">pbc</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">scales</span></code> is a list of 4 floats, representing the electrostatic scalings of 1-2,
1-3, 1-4 and 1-5 pairs. In this case, no scaling is applied to the electrostatic
interactions. <code class="docutils literal"><span class="pre">radii=None</span></code> indicates that point charges are used.
<code class="docutils literal"><span class="pre">Average=True</span></code> indicates that the set of charges are averaged over atoms of the same type.
Finally, <code class="docutils literal"><span class="pre">pbc=[0,0,0]</span></code> indicates that the system is not periodic. The returned
object <code class="docutils literal"><span class="pre">ff_ei</span></code> is an instance of the
<a class="reference external" href="http://molmod.github.io/QuickFF/rg_module.html#quickff.reference.YaffForceField">YaffForceField class</a>.</p>
<p>Now we have all required input, and we will write a new Program class, which
will inherits from the
<a class="reference external" href="http://molmod.github.io/QuickFF/rg_module.html#quickff.program.BaseProgram">BaseProgram class</a>,
and contain a sequence of instructions that will be executed consequently. In
this case, first a diagonal force field will be constructed (i.e. without any
cross terms), then we will add cross terms and fit the cross terms using a
Hessian least squares fit while keeping the diagonal terms fixed:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Program</span><span class="p">(</span><span class="n">BaseProgram</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">log</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="s1">&#39;PROGRAM&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="c1">#deriving diagonal force field</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_pt_generate</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_pt_estimate</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">average_pars</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_hc_estimatefc</span><span class="p">([</span><span class="s1">&#39;HC_FC_DIAG&#39;</span><span class="p">])</span>
            <span class="c1">#adding and fitting cross terms</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_cross_init</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_hc_estimatefc</span><span class="p">([</span><span class="s1">&#39;HC_FC_CROSS_ASS&#39;</span><span class="p">,</span> <span class="s1">&#39;HC_FC_CROSS_ASA&#39;</span><span class="p">],</span> <span class="n">logger_level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1">#write output</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">make_output</span><span class="p">()</span>
</pre></div>
</div>
<p>Finally, we can now setup the program and run it:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">#initialize and run program</span>
<span class="n">program</span> <span class="o">=</span> <span class="n">Program</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">ai</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">ffrefs</span><span class="o">=</span><span class="p">[</span><span class="n">ff_ei</span><span class="p">]</span> <span class="p">)</span>
<span class="n">program</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>To summarize, the entire script as well as the logger output is given below.</p>
<div class="toggle docutils container">
<div class="header docutils container">
<strong>Click to show/hide the entire script</strong></div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="kn">from</span> <span class="nn">yaff</span> <span class="kn">import</span> <span class="n">System</span>
<span class="kn">from</span> <span class="nn">molmod.io.fchk</span> <span class="kn">import</span> <span class="n">FCHKFile</span>

<span class="kn">from</span> <span class="nn">quickff.settings</span> <span class="kn">import</span> <span class="n">Settings</span>
<span class="kn">from</span> <span class="nn">quickff.reference</span> <span class="kn">import</span> <span class="n">SecondOrderTaylor</span><span class="p">,</span> <span class="n">get_ei_ff</span>
<span class="kn">from</span> <span class="nn">quickff.program</span> <span class="kn">import</span> <span class="n">BaseProgram</span>
<span class="kn">from</span> <span class="nn">quickff.log</span> <span class="kn">import</span> <span class="n">log</span>

<span class="kn">import</span> <span class="nn">h5py</span> <span class="kn">as</span> <span class="nn">h5</span>

<span class="c1">#define class for deriving the force field</span>
<span class="k">class</span> <span class="nc">Program</span><span class="p">(</span><span class="n">BaseProgram</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">log</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="s1">&#39;PROGRAM&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="c1">#deriving diagonal force field</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_pt_generate</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_pt_estimate</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">average_pars</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_hc_estimatefc</span><span class="p">([</span><span class="s1">&#39;HC_FC_DIAG&#39;</span><span class="p">])</span>
            <span class="c1">#adding and fitting cross terms</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_cross_init</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_hc_estimatefc</span><span class="p">([</span><span class="s1">&#39;HC_FC_CROSS_ASS&#39;</span><span class="p">,</span> <span class="s1">&#39;HC_FC_CROSS_ASA&#39;</span><span class="p">],</span> <span class="n">logger_level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1">#write output</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">make_output</span><span class="p">()</span>

<span class="c1">#settings</span>
<span class="k">with</span> <span class="n">log</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="s1">&#39;INIT&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">timer</span><span class="o">=</span><span class="s1">&#39;Initialization&#39;</span><span class="p">):</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">(</span><span class="n">fn_yaff</span><span class="o">=</span><span class="s1">&#39;pars_cov.txt&#39;</span><span class="p">,</span> <span class="n">plot_traj</span><span class="o">=</span><span class="s1">&#39;All&#39;</span><span class="p">,</span> <span class="n">xyz_traj</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1">#load Gaussian Formatted Checkpoint file</span>
<span class="n">fchk</span> <span class="o">=</span> <span class="n">FCHKFile</span><span class="p">(</span><span class="s1">&#39;gaussian.fchk&#39;</span><span class="p">)</span>
<span class="n">numbers</span> <span class="o">=</span> <span class="n">fchk</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Atomic numbers&#39;</span><span class="p">)</span>
<span class="n">energy</span> <span class="o">=</span> <span class="n">fchk</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Total Energy&#39;</span><span class="p">)</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">fchk</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Current cartesian coordinates&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">),</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">grad</span> <span class="o">=</span> <span class="n">fchk</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Cartesian Gradient&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">),</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">hess</span> <span class="o">=</span> <span class="n">fchk</span><span class="o">.</span><span class="n">get_hessian</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">),</span> <span class="mi">3</span><span class="p">])</span>

<span class="c1">#Construct Yaff System file</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">System</span><span class="p">(</span><span class="n">numbers</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
<span class="n">system</span><span class="o">.</span><span class="n">detect_bonds</span><span class="p">()</span>
<span class="n">system</span><span class="o">.</span><span class="n">set_standard_masses</span><span class="p">()</span>

<span class="c1">#Construct a QuickFF SecondOrderTaylor object containing the AI reference</span>
<span class="k">with</span> <span class="n">log</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="s1">&#39;INIT&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">timer</span><span class="o">=</span><span class="s1">&#39;Initialization&#39;</span><span class="p">):</span>
    <span class="n">ai</span> <span class="o">=</span> <span class="n">SecondOrderTaylor</span><span class="p">(</span><span class="s1">&#39;ai&#39;</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">,</span> <span class="n">energy</span><span class="o">=</span><span class="n">energy</span><span class="p">,</span> <span class="n">grad</span><span class="o">=</span><span class="n">grad</span><span class="p">,</span> <span class="n">hess</span><span class="o">=</span><span class="n">hess</span><span class="p">)</span>

<span class="c1">#define atom types</span>
<span class="n">rules</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;1 &amp; =1%8&#39;</span><span class="p">),</span> <span class="c1">#hydrogen atom with one oxygen neighbor</span>
    <span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;8 &amp; =2%1&#39;</span><span class="p">),</span> <span class="c1">#oxygen atom with two hydrogen neighbors</span>
<span class="p">]</span>
<span class="n">system</span><span class="o">.</span><span class="n">detect_ffatypes</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>

<span class="c1">#construct electrostatic force field from HE charges in gaussian_wpart.h5</span>
<span class="k">with</span> <span class="n">h5</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">&#39;gaussian_mbis.h5&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">charges</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;charges&#39;</span><span class="p">][:]</span>
<span class="n">scales</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="k">with</span> <span class="n">log</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="s1">&#39;INIT&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">timer</span><span class="o">=</span><span class="s1">&#39;Initialization&#39;</span><span class="p">):</span>
    <span class="n">ff_ei</span> <span class="o">=</span> <span class="n">get_ei_ff</span><span class="p">(</span><span class="s1">&#39;EI&#39;</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">charges</span><span class="p">,</span> <span class="n">scales</span><span class="p">,</span> <span class="n">radii</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">pbc</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

<span class="c1">#initialize and run program</span>
<span class="n">program</span> <span class="o">=</span> <span class="n">Program</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">ai</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">ffrefs</span><span class="o">=</span><span class="p">[</span><span class="n">ff_ei</span><span class="p">]</span> <span class="p">)</span>
<span class="n">program</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="toggle docutils container">
<div class="header docutils container">
<strong>Click to show/hide the logger output</strong></div>
<div class="highlight-text"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;qff-derive.py&quot;, line 30, in &lt;module&gt;
    settings = Settings(fn_yaff=&#39;pars_cov.txt&#39;, plot_traj=&#39;All&#39;, xyz_traj=True)
  File &quot;/home/louis/build/anaconda3/lib/python3.6/site-packages/quickff/settings.py&quot;, line 177, in __init__
    self.check()
  File &quot;/home/louis/build/anaconda3/lib/python3.6/site-packages/quickff/settings.py&quot;, line 241, in check
    check_function(key,value)
  File &quot;/home/louis/build/anaconda3/lib/python3.6/site-packages/quickff/settings.py&quot;, line 83, in is_nonexisting_file_name
    raise IOError(&#39;Setting for key %s should be non-existing file name, got %s which already exists.&#39; %(key, value))
OSError: Setting for key fn_yaff should be non-existing file name, got pars_cov.txt which already exists.
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="tutorial-3-biphenyl">
<span id="seclab-tu-biphenyl"></span><h2>Tutorial 3 - Biphenyl<a class="headerlink" href="#tutorial-3-biphenyl" title="Permalink to this headline">¶</a></h2>
<p>In the current tutorial, we will illustrate advanced features of QuickFF by
constructing a force field for biphenyl.</p>
<p>COMING SOON</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="vl.html" class="btn btn-neutral float-right" title="Validation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ug.html" class="btn btn-neutral" title="User Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Louis Vanduyfhuys, Center for Molecular Modeling, Ghent University

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'2.2.1',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>